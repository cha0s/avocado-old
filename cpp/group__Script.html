<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>AvocadoC++: Script SPI</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">AvocadoC++
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Script SPI</div>  </div>
</div><!--header-->
<div class="contents">

<p>The script SPI handles all communication between the native C++ engine and JavaScript.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Script SPI:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__Script.png" border="0" alt="" usemap="#group____Script"/>
<map name="group____Script" id="group____Script">
<area shape="rect" id="node2" href="group__SPI.html" title="Simply put, SPI implementations (SPIIs) provide an way for the engine to do interesting and dynamic t..." alt="" coords="260,176,439,205"/><area shape="rect" id="node3" href="group__V8.html" title="Avocado&#39;s interface to the V8 JavaScript engine." alt="" coords="271,335,428,364"/><area shape="rect" id="node4" href="group__Manufacturing.html" title="Manufacturing functionality handles abstract factory &#160;definition and managing concrete factory instan..." alt="" coords="297,528,401,557"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:namespaceavo_1_1V8"><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceavo_1_1V8.html">avo::V8</a></td></tr>
<tr class="memdesc:namespaceavo_1_1V8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility functions and embed bindings for <a href="http://code.google.com/p/v8/">V8</a>. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1Script.html">avo::Script</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1AbstractFactory_3_01Script_01_4.html">avo::AbstractFactory&lt; Script &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1ScriptService.html">avo::ScriptService</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">ScriptService manages embedding a JavaScript interpreter within the Avocado engine.  <a href="classavo_1_1ScriptService.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1AbstractFactory_3_01ScriptService_01_4.html">avo::AbstractFactory&lt; ScriptService &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8Script.html">avo::v8Script</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1AbstractFactory_3_01v8Script_01_4.html">avo::AbstractFactory&lt; v8Script &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8ScriptService.html">avo::v8ScriptService</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1AbstractFactory_3_01v8ScriptService_01_4.html">avo::AbstractFactory&lt; v8ScriptService &gt;</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1Script_1_1script__execution__error.html">avo::Script::script_execution_error</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thrown when executing a script fails.  <a href="classavo_1_1Script_1_1script__execution__error.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1ScriptService_1_1script__compilation__error.html">avo::ScriptService::script_compilation_error</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thrown when script compilation fails.  <a href="classavo_1_1ScriptService_1_1script__compilation__error.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1ScriptService_1_1script__precompilation__error.html">avo::ScriptService::script_precompilation_error</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thrown when script precompilation fails.  <a href="classavo_1_1ScriptService_1_1script__precompilation__error.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga0f1b91d048215f51e6dad1b94e031fe2"><td class="memItemLeft" align="right" valign="top">v8::Handle&lt; v8::Value &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#ga0f1b91d048215f51e6dad1b94e031fe2">avo::V8::toJson</a> (v8::Handle&lt; v8::Value &gt; value)</td></tr>
<tr class="separator:ga0f1b91d048215f51e6dad1b94e031fe2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab2217032ba2bdd1391084103af91dcb8"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#gab2217032ba2bdd1391084103af91dcb8">avo::V8::stringifyException</a> (const v8::TryCatch &amp;try_catch, bool suppressBacktrace)</td></tr>
<tr class="separator:gab2217032ba2bdd1391084103af91dcb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1d8680e247891fb68ebb7e96dd2852c7"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">avo::V8::stringToStdString</a> (v8::Handle&lt; v8::String &gt; value)</td></tr>
<tr class="separator:ga1d8680e247891fb68ebb7e96dd2852c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The script SPI handles all communication between the native C++ engine and JavaScript. </p>
<p>All other SPI interfaces (SPIIs) are managed through the script SPII. Avocado is designed to spend most of its time in JavaScript, so it's no overstatement that the script SPI is pretty much the most important SPI. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gab2217032ba2bdd1391084103af91dcb8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string avo::V8::stringifyException </td>
          <td>(</td>
          <td class="paramtype">const v8::TryCatch &amp;&#160;</td>
          <td class="paramname"><em>try_catch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>suppressBacktrace</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Turn an exception from <a class="el" href="namespaceavo_1_1V8.html" title="Utility functions and embed bindings for V8.">V8</a> into a string we can use to report the error. </p>
<div class="fragment"><div class="line">                                                                                  {</div>
<div class="line">    HandleScope scope;</div>
<div class="line">    std::string output = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"></div>
<div class="line">    Handle&lt;Message&gt; message = try_catch.Message();</div>
<div class="line">    <span class="keywordflow">if</span> (suppressBacktrace || message.IsEmpty()) {</div>
<div class="line"></div>
<div class="line">        std::string exception_string = <a class="code" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">V8::stringToStdString</a>(try_catch.Exception().As&lt;String&gt;());</div>
<div class="line"></div>
<div class="line">        <span class="comment">// V8 didn&#39;t provide any extra information about this error; just</span></div>
<div class="line">        <span class="comment">// print the exception.</span></div>
<div class="line">        output += exception_string;</div>
<div class="line">        output += <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line"></div>
<div class="line">        <span class="comment">// filename:line</span></div>
<div class="line">        output += <a class="code" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">V8::stringToStdString</a>(</div>
<div class="line">            message-&gt;GetScriptResourceName().As&lt;String&gt;()</div>
<div class="line">        ) + <span class="stringliteral">&quot;:&quot;</span> + boost::lexical_cast&lt;std::string&gt;(</div>
<div class="line">            message-&gt;GetLineNumber()</div>
<div class="line">        ) + <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Print line of source code.</span></div>
<div class="line">        output += <a class="code" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">V8::stringToStdString</a>(message-&gt;GetSourceLine()) + <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Print wavy underline (GetUnderline is deprecated).</span></div>
<div class="line">        <span class="keywordtype">int</span> start = message-&gt;GetStartColumn();</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; start; i++) {</div>
<div class="line">            output += <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordtype">int</span> end = message-&gt;GetEndColumn();</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = start; i &lt; end; i++) {</div>
<div class="line">            output += <span class="stringliteral">&quot;^&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        output += <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Print out the stack trace.</span></div>
<div class="line">        std::string stackTrace = <a class="code" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">V8::stringToStdString</a>(try_catch.StackTrace().As&lt;String&gt;());</div>
<div class="line">        <span class="keywordflow">if</span> (stackTrace.length() &gt; 0) {</div>
<div class="line">            output += stackTrace + <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> output;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga1d8680e247891fb68ebb7e96dd2852c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string avo::V8::stringToStdString </td>
          <td>(</td>
          <td class="paramtype">v8::Handle&lt; v8::String &gt;&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Convert a <a class="el" href="namespaceavo_1_1V8.html" title="Utility functions and embed bindings for V8.">V8</a> string to a std::string. </p>
<div class="fragment"><div class="line">                                                      {</div>
<div class="line">  String::Utf8Value utf8_value(value);</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> *utf8_value ? *utf8_value : <span class="stringliteral">&quot;&lt;string conversion failed&gt;&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga0f1b91d048215f51e6dad1b94e031fe2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">v8::Handle&lt; v8::Value &gt; avo::V8::toJson </td>
          <td>(</td>
          <td class="paramtype">v8::Handle&lt; v8::Value &gt;&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Take a JS value and convert it to JSON. This returns v8::Value and not v8::String because when JSON.stringify fails, we have to throw/return an exception. </p>
<div class="fragment"><div class="line">                                                  {</div>
<div class="line">    HandleScope scope;</div>
<div class="line"></div>
<div class="line">    Handle&lt;Context&gt; context = Context::GetCurrent();</div>
<div class="line">    Handle&lt;Object&gt; global = context-&gt;Global();</div>
<div class="line">    Handle&lt;Object&gt; JSON = global-&gt;Get(String::New(<span class="stringliteral">&quot;JSON&quot;</span>))-&gt;ToObject();</div>
<div class="line">    Handle&lt;Function&gt; JSON_stringify = Handle&lt;Function&gt;::Cast(JSON-&gt;Get(String::New(<span class="stringliteral">&quot;stringify&quot;</span>)));</div>
<div class="line"></div>
<div class="line">    <span class="comment">// JSON.stringify(values, null, &#39;\t&#39;);</span></div>
<div class="line">    Handle&lt;Value&gt; argv[] = {</div>
<div class="line">        value,</div>
<div class="line">        Null(),</div>
<div class="line">        String::New(<span class="stringliteral">&quot;\t&quot;</span>)</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    TryCatch exception;</div>
<div class="line"></div>
<div class="line">    Handle&lt;Value&gt; stringified = JSON_stringify-&gt;Call(JSON_stringify, 3, argv);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (exception.HasCaught()) {</div>
<div class="line">        <span class="keywordflow">return</span> exception.ReThrow();</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> scope.Close(stringified);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Oct 4 2012 01:34:53 for AvocadoC++ by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
