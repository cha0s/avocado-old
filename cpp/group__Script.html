<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>AvocadoC++: Script SPI</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

<link href="../../docs/doxygen/doxygen.css" rel="stylesheet" type="text/css" />
$extrastylesheet
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">AvocadoC++
   &#160;<span id="projectnumber">1.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- end header part -->
<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">Script SPI</div>  </div>
</div><!--header-->
<div class="contents">

<p>The script SPI handles all communication between the native C++ engine and JavaScript.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Script SPI:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__Script.png" border="0" alt="" usemap="#group____Script"/>
<map name="group____Script" id="group____Script">
<area shape="rect" id="node2" href="group__Core.html" title="The core SPI handles framework initialization (e.g. SDL_Init()) and teardown (e.g. SDL_Quit()) as well as bridges to core engine functionality like filesystem access." alt="" coords="429,36,504,65"/><area shape="rect" id="node3" href="group__Sound.html" title="The sound SPI handles sound system initialization, as well as music and sample loading and playing..." alt="" coords="424,119,509,148"/><area shape="rect" id="node4" href="group__Input.html" title="The input SPI handles user input polling." alt="" coords="428,184,505,213"/><area shape="rect" id="node5" href="group__SPI.html" title="Simply put, SPI implementations (SPIIs) provide an way for the engine to do interesting and dynamic t..." alt="" coords="377,405,556,435"/><area shape="rect" id="node6" href="group__V8.html" title="Avocado&#39;s interface to the [V8 JavaScript engine](http://code.google.com/p/v8/)." alt="" coords="388,648,545,677"/><area shape="rect" id="node7" href="group__Timing.html" title="The timing SPI handles measuring time." alt="" coords="424,723,509,752"/><area shape="rect" id="node8" href="group__Manufacturing.html" title="Manufacturing functionality handles abstract factory &#160;definition and managing concrete factory instan..." alt="" coords="415,823,519,852"/><area shape="rect" id="node9" href="group__Graphics.html" title="The graphics SPI handles window and graphics system initialization, and rendering." alt="" coords="417,923,516,952"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1Script.html">avo::Script</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1AbstractFactory_3_01Script_01_4.html">avo::AbstractFactory&lt; Script &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1ScriptService.html">avo::ScriptService</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">ScriptService manages embedding a JavaScript interpreter within the Avocado engine.  <a href="classavo_1_1ScriptService.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1AbstractFactory_3_01ScriptService_01_4.html">avo::AbstractFactory&lt; ScriptService &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1ObjectWrap.html">avo::ObjectWrap</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8CoreService.html">avo::v8CoreService</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8Counter.html">avo::v8Counter</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8GraphicsService.html">avo::v8GraphicsService</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8Image.html">avo::v8Image</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8Input.html">avo::v8Input</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8InputService.html">avo::v8InputService</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8Music.html">avo::v8Music</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8Sample.html">avo::v8Sample</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8Script.html">avo::v8Script</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1AbstractFactory_3_01v8Script_01_4.html">avo::AbstractFactory&lt; v8Script &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8ScriptService.html">avo::v8ScriptService</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1AbstractFactory_3_01v8ScriptService_01_4.html">avo::AbstractFactory&lt; v8ScriptService &gt;</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8SoundService.html">avo::v8SoundService</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8TimingService.html">avo::v8TimingService</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classavo_1_1v8Window.html">avo::v8Window</a></td></tr>
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceavo_1_1V8.html">avo::V8</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>Utility functions and embed bindings for [<a class="el" href="namespaceavo_1_1V8.html" title="Utility functions and embed bindings for [V8](http://code.google.com/p/v8/).">V8</a>](<a href="http://code.google.com/p/v8/">http://code.google.com/p/v8/</a>). </p>
<br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">v8::Handle&lt; v8::Value &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#ga0f1b91d048215f51e6dad1b94e031fe2">avo::V8::toJson</a> (v8::Handle&lt; v8::Value &gt; value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#gab2217032ba2bdd1391084103af91dcb8">avo::V8::stringifyException</a> (const v8::TryCatch &amp;try_catch, bool suppressBacktrace)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">avo::V8::stringToStdString</a> (v8::Handle&lt; v8::String &gt; value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#gaaa16ea6d28b0f6a9f3ce42075e775a45">avo::ObjectWrap::~ObjectWrap</a> ()</td></tr>
<tr><td class="memTemplParams" colspan="2">template&lt;class T &gt; </td></tr>
<tr><td class="memTemplItemLeft" align="right" valign="top">static T *&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__Script.html#gadb324bfe6517d6f197734a391dc5f5e0">avo::ObjectWrap::Unwrap</a> (v8::Handle&lt; v8::Object &gt; handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#ga62523c3ab5857e642383a40349b7dc79">avo::ObjectWrap::Wrap</a> (v8::Handle&lt; v8::Object &gt; handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#gaec19633e25ddd0a83a394552a06a4459">avo::v8Input::~v8Input</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#gad81d8c7525dde8bd685dcd6e96240a43">avo::v8Input::initialize</a> (v8::Handle&lt; v8::ObjectTemplate &gt; target)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">v8::Persistent&lt; v8::Object &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">avo::ObjectWrap::handle_</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">Input *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Script.html#gad398079b912a217569531f82a1f65de8">avo::v8Input::input</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>The script SPI handles all communication between the native C++ engine and JavaScript. </p>
<p>All other SPI interfaces (SPIIs) are managed through the script SPII. Avocado is designed to spend most of its time in JavaScript, so it's no overstatement that the script SPI is pretty much the most important SPI. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="gad81d8c7525dde8bd685dcd6e96240a43"></a><!-- doxytag: member="avo::v8Input::initialize" ref="gad81d8c7525dde8bd685dcd6e96240a43" args="(v8::Handle&lt; v8::ObjectTemplate &gt; target)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="group__Script.html#gad81d8c7525dde8bd685dcd6e96240a43">avo::v8Input::initialize</a> </td>
          <td>(</td>
          <td class="paramtype">v8::Handle&lt; v8::ObjectTemplate &gt;&#160;</td>
          <td class="paramname"><em>target</em></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                                                      {
    HandleScope scope;

    Handle&lt;FunctionTemplate&gt; constructor_template = FunctionTemplate::New(v8Input::New);
    constructor_template-&gt;InstanceTemplate()-&gt;SetInternalFieldCount(1);
    constructor_template-&gt;SetClassName(String::NewSymbol(<span class="stringliteral">&quot;v8Input&quot;</span>));

    <a class="code" href="avocado-v8_8h.html#a32ad28418d7e48ccde27840235c819cb">V8_SET_PROTOTYPE_METHOD</a>(constructor_template, <span class="stringliteral">&quot;poll&quot;</span>, v8Input::Poll);

    target-&gt;Set(String::NewSymbol(<span class="stringliteral">&quot;Input&quot;</span>), constructor_template);
}
</pre></div>
</div>
</div>
<a class="anchor" id="gab2217032ba2bdd1391084103af91dcb8"></a><!-- doxytag: member="avo::V8::stringifyException" ref="gab2217032ba2bdd1391084103af91dcb8" args="(const v8::TryCatch &amp;try_catch, bool suppressBacktrace)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="group__Script.html#gab2217032ba2bdd1391084103af91dcb8">avo::V8::stringifyException</a> </td>
          <td>(</td>
          <td class="paramtype">const v8::TryCatch &amp;&#160;</td>
          <td class="paramname"><em>try_catch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>suppressBacktrace</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Turn an exception from <a class="el" href="namespaceavo_1_1V8.html" title="Utility functions and embed bindings for [V8](http://code.google.com/p/v8/).">V8</a> into a string we can use to report the error. </p>
<div class="fragment"><pre class="fragment">                                                                                  {
    HandleScope scope;
    std::string output = <span class="stringliteral">&quot;&quot;</span>;

    Handle&lt;Message&gt; message = try_catch.Message();
    <span class="keywordflow">if</span> (suppressBacktrace || message.IsEmpty()) {

        std::string exception_string = <a class="code" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">V8::stringToStdString</a>(try_catch.Exception().As&lt;String&gt;());

        <span class="comment">// V8 didn&#39;t provide any extra information about this error; just</span>
        <span class="comment">// print the exception.</span>
        output += exception_string;
        output += <span class="stringliteral">&quot;\n&quot;</span>;

    } <span class="keywordflow">else</span> {

        <span class="comment">// filename:line</span>
        output += <a class="code" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">V8::stringToStdString</a>(
            message-&gt;GetScriptResourceName().As&lt;String&gt;()
        ) + <span class="stringliteral">&quot;:&quot;</span> + boost::lexical_cast&lt;std::string&gt;(
            message-&gt;GetLineNumber()
        ) + <span class="stringliteral">&quot;\n&quot;</span>;

        <span class="comment">// Print line of source code.</span>
        output += <a class="code" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">V8::stringToStdString</a>(message-&gt;GetSourceLine()) + <span class="stringliteral">&quot;\n&quot;</span>;

        <span class="comment">// Print wavy underline (GetUnderline is deprecated).</span>
        <span class="keywordtype">int</span> start = message-&gt;GetStartColumn();
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; start; i++) {
            output += <span class="stringliteral">&quot; &quot;</span>;
        }
        <span class="keywordtype">int</span> end = message-&gt;GetEndColumn();
        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = start; i &lt; end; i++) {
            output += <span class="stringliteral">&quot;^&quot;</span>;
        }
        output += <span class="stringliteral">&quot;\n&quot;</span>;

        <span class="comment">// Print out the stack trace.</span>
        std::string stackTrace = <a class="code" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">V8::stringToStdString</a>(try_catch.StackTrace().As&lt;String&gt;());
        <span class="keywordflow">if</span> (stackTrace.length() &gt; 0) {
            output += stackTrace + <span class="stringliteral">&quot;\n&quot;</span>;
        }
    }

    <span class="keywordflow">return</span> output;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga1d8680e247891fb68ebb7e96dd2852c7"></a><!-- doxytag: member="avo::V8::stringToStdString" ref="ga1d8680e247891fb68ebb7e96dd2852c7" args="(v8::Handle&lt; v8::String &gt; value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="group__Script.html#ga1d8680e247891fb68ebb7e96dd2852c7">avo::V8::stringToStdString</a> </td>
          <td>(</td>
          <td class="paramtype">v8::Handle&lt; v8::String &gt;&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Convert a <a class="el" href="namespaceavo_1_1V8.html" title="Utility functions and embed bindings for [V8](http://code.google.com/p/v8/).">V8</a> string to a std::string. </p>
<div class="fragment"><pre class="fragment">                                                      {
  String::Utf8Value utf8_value(value);

  <span class="keywordflow">return</span> *utf8_value ? *utf8_value : <span class="stringliteral">&quot;&lt;string conversion failed&gt;&quot;</span>;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ga0f1b91d048215f51e6dad1b94e031fe2"></a><!-- doxytag: member="avo::V8::toJson" ref="ga0f1b91d048215f51e6dad1b94e031fe2" args="(v8::Handle&lt; v8::Value &gt; value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">v8::Handle&lt; v8::Value &gt; <a class="el" href="group__Script.html#ga0f1b91d048215f51e6dad1b94e031fe2">avo::V8::toJson</a> </td>
          <td>(</td>
          <td class="paramtype">v8::Handle&lt; v8::Value &gt;&#160;</td>
          <td class="paramname"><em>value</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Take a JS value and convert it to JSON. This returns v8::Value and not v8::String because when JSON.stringify fails, we have to throw/return an exception. </p>
<div class="fragment"><pre class="fragment">                                                  {
    HandleScope scope;

    Handle&lt;Context&gt; context = Context::GetCurrent();
    Handle&lt;Object&gt; global = context-&gt;Global();
    Handle&lt;Object&gt; JSON = global-&gt;Get(String::New(<span class="stringliteral">&quot;JSON&quot;</span>))-&gt;ToObject();
    Handle&lt;Function&gt; JSON_stringify = Handle&lt;Function&gt;::Cast(JSON-&gt;Get(String::New(<span class="stringliteral">&quot;stringify&quot;</span>)));

    <span class="comment">// JSON.stringify(values, null, &#39;\t&#39;);</span>
    Handle&lt;Value&gt; argv[] = {
        value,
        Null(),
        String::New(<span class="stringliteral">&quot;\t&quot;</span>)
    };

    TryCatch exception;

    Handle&lt;Value&gt; stringified = JSON_stringify-&gt;Call(JSON_stringify, 3, argv);

    <span class="keywordflow">if</span> (exception.HasCaught()) {
        <span class="keywordflow">return</span> exception.ReThrow();
    }

    <span class="keywordflow">return</span> scope.Close(stringified);
}
</pre></div>
</div>
</div>
<a class="anchor" id="gadb324bfe6517d6f197734a391dc5f5e0"></a><!-- doxytag: member="avo::ObjectWrap::Unwrap" ref="gadb324bfe6517d6f197734a391dc5f5e0" args="(v8::Handle&lt; v8::Object &gt; handle)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">static T* <a class="el" href="group__Script.html#gadb324bfe6517d6f197734a391dc5f5e0">avo::ObjectWrap::Unwrap</a> </td>
          <td>(</td>
          <td class="paramtype">v8::Handle&lt; v8::Object &gt;&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get the T pointer from inside an object. </p>
<div class="fragment"><pre class="fragment">                                                       {

        <span class="comment">// Ensure there&#39;s an object pointer in here.</span>
        <span class="keywordflow">if</span> (handle.IsEmpty() || 0 == handle-&gt;InternalFieldCount()) <span class="keywordflow">return</span> NULL;

        <span class="comment">// Return the object pointer.</span>
        <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>T *<span class="keyword">&gt;</span>(handle-&gt;GetPointerFromInternalField(0));
    }
</pre></div>
</div>
</div>
<a class="anchor" id="ga62523c3ab5857e642383a40349b7dc79"></a><!-- doxytag: member="avo::ObjectWrap::Wrap" ref="ga62523c3ab5857e642383a40349b7dc79" args="(v8::Handle&lt; v8::Object &gt; handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="group__Script.html#ga62523c3ab5857e642383a40349b7dc79">avo::ObjectWrap::Wrap</a> </td>
          <td>(</td>
          <td class="paramtype">v8::Handle&lt; v8::Object &gt;&#160;</td>
          <td class="paramname"><em>handle</em></td><td>)</td>
          <td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Wrap this class with the passed in object. </p>
<div class="fragment"><pre class="fragment">                                                {

        <span class="comment">// Make sure our handle isn&#39;t wrapping anything yet,</span>
        assert(<a class="code" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">handle_</a>.IsEmpty());
        <span class="comment">// and the passed in wrapper is expecting an object pointer.</span>
        assert(handle-&gt;InternalFieldCount() &gt; 0);
        <span class="comment">// Allocate and embed our object pointer.</span>
        <a class="code" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">handle_</a> = v8::Persistent&lt;v8::Object&gt;::New(handle);
        handle_-&gt;SetPointerInInternalField(0, <span class="keyword">this</span>);
        <span class="comment">// Mark it as &#39;weak&#39; so GC will release it ASAP.</span>
        handle_.MakeWeak(<span class="keyword">this</span>, WeakCallback);
        handle_.MarkIndependent();
    }
</pre></div>
</div>
</div>
<a class="anchor" id="gaaa16ea6d28b0f6a9f3ce42075e775a45"></a><!-- doxytag: member="avo::ObjectWrap::~ObjectWrap" ref="gaaa16ea6d28b0f6a9f3ce42075e775a45" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__Script.html#gaaa16ea6d28b0f6a9f3ce42075e775a45">avo::ObjectWrap::~ObjectWrap</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Called at GC. </p>
<div class="fragment"><pre class="fragment">                        {

    <span class="comment">// Only kill it once.</span>
    <span class="keywordflow">if</span> (!<a class="code" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">handle_</a>.IsEmpty()) {

        <span class="comment">// GC has run?</span>
        assert(<a class="code" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">handle_</a>.IsNearDeath());

        <span class="comment">// NULL out the handle.</span>
        <a class="code" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">handle_</a>.ClearWeak();
        <a class="code" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">handle_</a>-&gt;SetInternalField(0, v8::Undefined());
        <a class="code" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">handle_</a>.Dispose();
        <a class="code" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">handle_</a>.Clear();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="gaec19633e25ddd0a83a394552a06a4459"></a><!-- doxytag: member="avo::v8Input::~v8Input" ref="gaec19633e25ddd0a83a394552a06a4459" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__Script.html#gaec19633e25ddd0a83a394552a06a4459">avo::v8Input::~v8Input</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">                  {
    <span class="keyword">delete</span> <a class="code" href="group__Script.html#gad398079b912a217569531f82a1f65de8">input</a>;
}
</pre></div>
</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ga848006aed612f9574f86c28a8e7587ea"></a><!-- doxytag: member="avo::ObjectWrap::handle_" ref="ga848006aed612f9574f86c28a8e7587ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">v8::Persistent&lt;v8::Object&gt; <a class="el" href="group__Script.html#ga848006aed612f9574f86c28a8e7587ea">avo::ObjectWrap::handle_</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Keep our object around until GC releases it. </p>

</div>
</div>
<a class="anchor" id="gad398079b912a217569531f82a1f65de8"></a><!-- doxytag: member="avo::v8Input::input" ref="gad398079b912a217569531f82a1f65de8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Input* <a class="el" href="group__Script.html#gad398079b912a217569531f82a1f65de8">avo::v8Input::input</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<!-- start footer part -->


<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
