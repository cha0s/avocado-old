<!DOCTYPE html><html><head><title>Image.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../engine/core/CoreService.coffee.html" class="source "><span class="base_path">engine / core / </span><span class="file_name">CoreService.coffee</span></a><a href="../../../engine/core/Extension/String.coffee.html" class="source "><span class="base_path">engine / core / Extension / </span><span class="file_name">String.coffee</span></a><a href="../../../engine/core/Extension/Vector.coffee.html" class="source "><span class="base_path">engine / core / Extension / </span><span class="file_name">Vector.coffee</span></a><a href="../../../engine/core/Graphics/Image.coffee.html" class="source selected"><span class="base_path">engine / core / Graphics / </span><span class="file_name">Image.coffee</span></a><a href="../../../engine/core/Graphics/Window.coffee.html" class="source "><span class="base_path">engine / core / Graphics / </span><span class="file_name">Window.coffee</span></a><a href="../../../engine/core/Input/Input.coffee.html" class="source "><span class="base_path">engine / core / Input / </span><span class="file_name">Input.coffee</span></a><a href="../../../engine/core/Main.coffee.html" class="source "><span class="base_path">engine / core / </span><span class="file_name">Main.coffee</span></a><a href="../../../engine/core/Sound/Music.coffee.html" class="source "><span class="base_path">engine / core / Sound / </span><span class="file_name">Music.coffee</span></a><a href="../../../engine/core/Sound/Sample.coffee.html" class="source "><span class="base_path">engine / core / Sound / </span><span class="file_name">Sample.coffee</span></a><a href="../../../engine/core/State/AbstractState.coffee.html" class="source "><span class="base_path">engine / core / State / </span><span class="file_name">AbstractState.coffee</span></a><a href="../../../engine/core/State/Initial.coffee.html" class="source "><span class="base_path">engine / core / State / </span><span class="file_name">Initial.coffee</span></a><a href="../../../engine/core/Timing/Counter.coffee.html" class="source "><span class="base_path">engine / core / Timing / </span><span class="file_name">Counter.coffee</span></a><a href="../../../engine/core/Timing/Cps.coffee.html" class="source "><span class="base_path">engine / core / Timing / </span><span class="file_name">Cps.coffee</span></a><a href="../../../engine/core/Timing/Ticker.coffee.html" class="source "><span class="base_path">engine / core / Timing / </span><span class="file_name">Ticker.coffee</span></a><a href="../../../engine/core/Timing/TimingService.coffee.html" class="source "><span class="base_path">engine / core / Timing / </span><span class="file_name">TimingService.coffee</span></a><a href="../../../engine/core/Utility/EventEmitter.coffee.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">EventEmitter.coffee</span></a><a href="../../../engine/core/Utility/Logger.coffee.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">Logger.coffee</span></a><a href="../../../engine/core/Utility/Mixin.coffee.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">Mixin.coffee</span></a><a href="../../../engine/core/Utility/Transition.coffee.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">Transition.coffee</span></a><a href="../../../engine/core/Utility/upon.js.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">upon.js</span></a><a href="../../../engine/main/native/Finish.coffee.html" class="source "><span class="base_path">engine / main / native / </span><span class="file_name">Finish.coffee</span></a><a href="../../../engine/main/native/Initialize.coffee.html" class="source "><span class="base_path">engine / main / native / </span><span class="file_name">Initialize.coffee</span></a><a href="../../../engine/main/native/Main.coffee.html" class="source "><span class="base_path">engine / main / native / </span><span class="file_name">Main.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>Image.coffee</h1><div class="filepath">engine/core/Graphics/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>SPI proxy and constant definitions.</p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>avo.<strong>Image</strong> handles image resource management. Primitive operations such
as filling, line, circle, box drawing and rasterization are supported. All
image resources are loaded through avo.<strong>Image</strong>.load. </p>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Draw mode constants.</p>

<ul>
<li><code>avo.Image.DrawMode_Replace</code>: Write over any graphics under this
image when rendering.</li>
<li><code>avo.Image.DrawMode_Blend</code>: Blend the image with any graphics
underneath using alpha pixel values.</li>
</ul>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image.DrawMode_Replace = </span><span class="mi">0</span>
<span class="nv">avo.Image.DrawMode_Blend   = </span><span class="mi">1</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Calculate the pixel value of two pixels blended together with alpha.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image.blendPixel = </span><span class="nf">(src, dst, alpha = 255) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">src</span><span class="o">?</span> <span class="o">and</span> <span class="nx">dst</span><span class="o">?</span>
  </pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>If source alpha is 0, then use the destination.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="p">{</span><span class="nx">sr</span><span class="p">,</span> <span class="nx">sg</span><span class="p">,</span> <span class="nx">sb</span><span class="p">,</span> <span class="nx">sa</span><span class="p">}</span> <span class="o">=</span> <span class="nx">Rgba</span> <span class="nx">src</span>
  <span class="k">return</span> <span class="nx">dst</span> <span class="nx">unless</span> <span class="nx">sa</span> <span class="o">&gt;</span> <span class="mi">0</span>
  </pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Calculate the source pixel alpha.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">pAlpha = </span><span class="nx">sa</span> <span class="o">*</span> <span class="p">(</span><span class="nx">alpha</span> <span class="err">/ 255)</span>
  </pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Do the <a href="http://en.wikipedia.org/wiki/Alpha_compositing#Alpha_blending">alpha blending</a>.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="p">{</span><span class="nx">dr</span><span class="p">,</span> <span class="nx">dg</span><span class="p">,</span> <span class="nx">db</span><span class="p">,</span> <span class="nx">da</span><span class="p">}</span> <span class="o">=</span> <span class="nx">Rgba</span> <span class="nx">dst</span>
  <span class="nv">dr = </span><span class="p">(</span><span class="nx">sr</span> <span class="o">*</span> <span class="nx">pAlpha</span> <span class="o">+</span> <span class="nx">dr</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">pAlpha</span><span class="p">))</span> <span class="o">/</span> <span class="mi">255</span>
  <span class="nv">dg = </span><span class="p">(</span><span class="nx">sg</span> <span class="o">*</span> <span class="nx">pAlpha</span> <span class="o">+</span> <span class="nx">dg</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">pAlpha</span><span class="p">))</span> <span class="o">/</span> <span class="mi">255</span>
  <span class="nv">db = </span><span class="p">(</span><span class="nx">sb</span> <span class="o">*</span> <span class="nx">pAlpha</span> <span class="o">+</span> <span class="nx">db</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">-</span> <span class="nx">pAlpha</span><span class="p">))</span> <span class="o">/</span> <span class="mi">255</span>
  <span class="nv">da = </span><span class="nx">pAlpha</span>
  </pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Shift the pixel colors back into a single 32-bit integer.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">Rgba</span> <span class="nx">dr</span><span class="p">,</span> <span class="nx">dg</span><span class="p">,</span> <span class="nx">db</span><span class="p">,</span> <span class="nx">da</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Load an image at the specified URI.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image.load = </span><span class="nf">(uri) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">uri</span><span class="o">?</span>
  
  <span class="nx">avo</span><span class="p">.</span><span class="nx">Image</span><span class="p">[</span><span class="s1">&#39;%load&#39;</span><span class="p">]</span> <span class="nx">uri</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Draw a circle at the given x, y with the given radius. Draw it with the given
RGBA color, and with the given draw mode.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::drawCircle = </span><span class="nf">(point, radius, r, g, b, a = 255, mode = avo.Image.DrawMode_Blend) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">point</span><span class="o">?</span> <span class="o">and</span> <span class="nx">radius</span><span class="o">?</span> <span class="o">and</span> <span class="nx">r</span><span class="o">?</span> <span class="o">and</span> <span class="nx">g</span><span class="o">?</span> <span class="o">and</span> <span class="nx">b</span><span class="o">?</span>
  
  <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%drawCircle&#39;</span><span class="p">]</span> <span class="nx">point</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">mode</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Draw a filled box at the given x, y with the given width, height dimensions.
Draw it with the given RGBA color, and with the given draw mode.    </p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::drawFilledBox = </span><span class="nf">(box, r, g, b, a = 255, mode = avo.Image.DrawMode_Blend) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">box</span><span class="o">?</span> <span class="o">and</span> <span class="nx">r</span><span class="o">?</span> <span class="o">and</span> <span class="nx">g</span><span class="o">?</span> <span class="o">and</span> <span class="nx">b</span><span class="o">?</span>
  
  <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%drawFilledBox&#39;</span><span class="p">]</span> <span class="nx">box</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">mode</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Draw a line at the given x, y to the x2, y2. Draw it with the given RGBA
color, and with the given draw mode.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::drawLine = </span><span class="nf">(line, r, g, b, a = 255, mode = avo.Image.DrawMode_Blend) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">line</span><span class="o">?</span> <span class="o">and</span> <span class="nx">r</span><span class="o">?</span> <span class="o">and</span> <span class="nx">g</span><span class="o">?</span> <span class="o">and</span> <span class="nx">b</span><span class="o">?</span>
  
  <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%drawLine&#39;</span><span class="p">]</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">mode</span>
  </pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Draw a box at the given x, y with the given width, height dimensions. Draw it
with the given RGBA color, and with the given draw mode.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::drawLineBox = </span><span class="nf">(box, r, g, b, a = 255, mode = avo.Image.DrawMode_Blend) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">box</span><span class="o">?</span> <span class="o">and</span> <span class="nx">r</span><span class="o">?</span> <span class="o">and</span> <span class="nx">g</span><span class="o">?</span> <span class="o">and</span> <span class="nx">b</span><span class="o">?</span>
  
  <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%drawLineBox&#39;</span><span class="p">]</span> <span class="nx">box</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">mode</span>
  </pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Fill with a specified color.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::fill = </span><span class="nf">(r, g, b, a = 255) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">r</span><span class="o">?</span> <span class="o">and</span> <span class="nx">g</span><span class="o">?</span> <span class="o">and</span> <span class="nx">b</span><span class="o">?</span>
  
  <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%fill&#39;</span><span class="p">]</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">a</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Get the height of the image.    </p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::height = </span><span class="err">@</span><span class="p">[</span><span class="s1">&#39;%height&#39;</span><span class="p">]</span>

<span class="nv">avo.Image::lockPixels = </span><span class="o">-&gt;</span> <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%lockPixels&#39;</span><span class="p">]</span><span class="o">?</span><span class="p">()</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Get the pixel color at a given x, y coordinate.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::pixelAt = </span><span class="nf">(x, y) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">x</span><span class="o">?</span> <span class="o">and</span> <span class="nx">y</span><span class="o">?</span>
  
  <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%pixelAt&#39;</span><span class="p">]</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>
  </pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>Render this image at x, y onto another image with the given alpha blending
and draw mode, using the given sx, sy, sw, sh source rectangle to clip.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::render = </span><span class="nf">(position, destination, alpha = 255, mode = avo.Image.DrawMode_Blend, sourceRect = [0, 0, 0, 0]) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">position</span><span class="o">?</span> <span class="o">and</span> <span class="nx">destination</span><span class="o">?</span>
  
  <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%render&#39;</span><span class="p">]</span> <span class="nx">position</span><span class="p">,</span> <span class="nx">destination</span><span class="p">,</span> <span class="nx">alpha</span><span class="p">,</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">sourceRect</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Set the pixel color at a given x, y coordinate.    </p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::setPixelAt = </span><span class="nf">(x, y, color) -&gt;</span>
  <span class="k">return</span> <span class="nx">unless</span> <span class="nx">x</span><span class="o">?</span> <span class="o">and</span> <span class="nx">y</span><span class="o">?</span> <span class="o">and</span> <span class="nx">color</span><span class="o">?</span>
  
  <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%setPixelAt&#39;</span><span class="p">]</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">color</span>
  </pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>Get the size of the image.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::size = </span><span class="o">-&gt;</span> <span class="p">[</span><span class="nx">@width</span><span class="p">(),</span> <span class="nx">@height</span><span class="p">()]</span>

<span class="nv">avo.Image::unlockPixels = </span><span class="o">-&gt;</span> <span class="err">@</span><span class="p">[</span><span class="s1">&#39;%unlockPixels&#39;</span><span class="p">]</span><span class="o">?</span><span class="p">()</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Get the URI (if any) used to load this image.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::uri = </span><span class="err">@</span><span class="p">[</span><span class="s1">&#39;%uri&#39;</span><span class="p">]</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Get the width of the image.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">avo.Image::width = </span><span class="err">@</span><span class="p">[</span><span class="s1">&#39;%width&#39;</span><span class="p">]</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Thu Oct 04 2012 01:01:05 GMT-0500 (CDT)  </div><div id="projectname"><a href="../../../index.html">Avocado</a></div></div></body></html>