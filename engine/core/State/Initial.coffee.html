<!DOCTYPE html><html><head><title>Initial.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../engine/core/CoreService.coffee.html" class="source "><span class="base_path">engine / core / </span><span class="file_name">CoreService.coffee</span></a><a href="../../../engine/core/Extension/String.coffee.html" class="source "><span class="base_path">engine / core / Extension / </span><span class="file_name">String.coffee</span></a><a href="../../../engine/core/Extension/Vector.coffee.html" class="source "><span class="base_path">engine / core / Extension / </span><span class="file_name">Vector.coffee</span></a><a href="../../../engine/core/Graphics/Image.coffee.html" class="source "><span class="base_path">engine / core / Graphics / </span><span class="file_name">Image.coffee</span></a><a href="../../../engine/core/Graphics/Window.coffee.html" class="source "><span class="base_path">engine / core / Graphics / </span><span class="file_name">Window.coffee</span></a><a href="../../../engine/core/Input/Input.coffee.html" class="source "><span class="base_path">engine / core / Input / </span><span class="file_name">Input.coffee</span></a><a href="../../../engine/core/Main.coffee.html" class="source "><span class="base_path">engine / core / </span><span class="file_name">Main.coffee</span></a><a href="../../../engine/core/Sound/Music.coffee.html" class="source "><span class="base_path">engine / core / Sound / </span><span class="file_name">Music.coffee</span></a><a href="../../../engine/core/Sound/Sample.coffee.html" class="source "><span class="base_path">engine / core / Sound / </span><span class="file_name">Sample.coffee</span></a><a href="../../../engine/core/State/AbstractState.coffee.html" class="source "><span class="base_path">engine / core / State / </span><span class="file_name">AbstractState.coffee</span></a><a href="../../../engine/core/State/Initial.coffee.html" class="source selected"><span class="base_path">engine / core / State / </span><span class="file_name">Initial.coffee</span></a><a href="../../../engine/core/Timing/Counter.coffee.html" class="source "><span class="base_path">engine / core / Timing / </span><span class="file_name">Counter.coffee</span></a><a href="../../../engine/core/Timing/Cps.coffee.html" class="source "><span class="base_path">engine / core / Timing / </span><span class="file_name">Cps.coffee</span></a><a href="../../../engine/core/Timing/Ticker.coffee.html" class="source "><span class="base_path">engine / core / Timing / </span><span class="file_name">Ticker.coffee</span></a><a href="../../../engine/core/Timing/TimingService.coffee.html" class="source "><span class="base_path">engine / core / Timing / </span><span class="file_name">TimingService.coffee</span></a><a href="../../../engine/core/Utility/EventEmitter.coffee.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">EventEmitter.coffee</span></a><a href="../../../engine/core/Utility/Logger.coffee.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">Logger.coffee</span></a><a href="../../../engine/core/Utility/Mixin.coffee.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">Mixin.coffee</span></a><a href="../../../engine/core/Utility/Transition.coffee.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">Transition.coffee</span></a><a href="../../../engine/core/Utility/upon.js.html" class="source "><span class="base_path">engine / core / Utility / </span><span class="file_name">upon.js</span></a><a href="../../../engine/main/native/Finish.coffee.html" class="source "><span class="base_path">engine / main / native / </span><span class="file_name">Finish.coffee</span></a><a href="../../../engine/main/native/Initialize.coffee.html" class="source "><span class="base_path">engine / main / native / </span><span class="file_name">Initialize.coffee</span></a><a href="../../../engine/main/native/Main.coffee.html" class="source "><span class="base_path">engine / main / native / </span><span class="file_name">Main.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>Initial.coffee</h1><div class="filepath">engine/core/State/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>Avocado loads the 'Initial' state, and from there it's all up to you!</p>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nx">avo</span><span class="p">.</span><span class="nx">Main</span><span class="p">.</span><span class="nx">States</span><span class="p">[</span><span class="s1">&#39;Initial&#39;</span><span class="p">]</span> <span class="k">extends</span> <span class="nx">avo</span><span class="p">.</span><span class="nx">AbstractState</span>
  </pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Called the first time this state is loaded. You can set up any stuff your
state needs here. This is the Initial state, so we can also set up
things specific to our game.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">initialize: </span><span class="o">-&gt;</span>
    </pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Let's move around the avocado! In order to do that, we'll need to
keep track of its x, y location.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    </pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Register a player (0) to receive input using the keyboard arrow keys
and joystick index 0.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="nx">registerPlayerMovement</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span>
      <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="nx">SpecialKeys</span><span class="p">.</span><span class="nx">UpArrow</span>
      <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="nx">SpecialKeys</span><span class="p">.</span><span class="nx">RightArrow</span>
      <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="nx">SpecialKeys</span><span class="p">.</span><span class="nx">DownArrow</span>
      <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="nx">SpecialKeys</span><span class="p">.</span><span class="nx">LeftArrow</span>
    <span class="p">],</span> <span class="mi">0</span>
    </pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Allow dragging the avocado around with the left mouse button. Keep
track of where the avocado was when we started dragging.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="vi">@dragStartAvocadoLocation = </span><span class="p">[]</span>
    <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;mouseButtonDown.InitialState&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">button</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">return</span> <span class="nx">unless</span> <span class="nx">button</span> <span class="o">is</span> <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="nx">LeftButton</span>
      <span class="vi">@dragStartAvocadoLocation = </span><span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">]</span>
    <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="kc">on</span> <span class="s1">&#39;mouseDrag.InitialState&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">button</span><span class="p">,</span> <span class="nx">relative</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="k">return</span> <span class="nx">unless</span> <span class="nx">button</span> <span class="o">is</span> <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="nx">LeftButton</span>
      <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">avo</span><span class="p">.</span><span class="nx">Vector</span><span class="p">.</span><span class="nx">add</span> <span class="nx">@dragStartAvocadoLocation</span><span class="p">,</span> <span class="nx">relative</span>
    </pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Yum, an avocado!</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">imagePromise = </span><span class="nx">avo</span><span class="p">.</span><span class="nx">Image</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;/image/avocado.png&#39;</span><span class="p">).</span><span class="k">then</span> <span class="p">(</span><span class="nx">@avocado</span><span class="p">)</span> <span class="o">=&gt;</span>
    </pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Happy music!</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">musicPromise = </span><span class="nx">avo</span><span class="p">.</span><span class="nx">Music</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">&#39;/music/smile.ogg&#39;</span><span class="p">).</span><span class="k">then</span> <span class="p">(</span><span class="nx">@music</span><span class="p">)</span> <span class="o">=&gt;</span>
    </pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Start it as soon as it loads.</p>
</td><td class="code"><div class="highlight"><pre>      <span class="nx">@music</span><span class="p">.</span><span class="nx">play</span><span class="p">()</span>
    </pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>When the image and music are done loading, then we're done
initializing. Remember - with CoffeeScript, the last statement in
a function is the return value. And upon.all returns a promise, just
as initialize requires. Elegant!</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">upon</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
      <span class="nx">imagePromise</span>
      <span class="nx">musicPromise</span>
    <span class="p">])</span>
  </pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Called repeatedly while this state is loaded. You can do things like
update your world here. We'll move the avocado based on movement input.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">tick: </span><span class="o">-&gt;</span>
    </pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Move it 500px a second based on player 0's movement.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">avo</span><span class="p">.</span><span class="nx">Vector</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
      <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">]</span>
      <span class="nx">avo</span><span class="p">.</span><span class="nx">Vector</span><span class="p">.</span><span class="nx">scale</span> <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="nx">playerTickMovement</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">500</span>
    <span class="p">)</span>
  </pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Called repeatedly while this state is loaded. You can render all of
your pretty pictures here!</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">render: </span><span class="nf">(buffer) -&gt;</span>
    </pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Fill the screen with white.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">buffer</span><span class="p">.</span><span class="nx">fill</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span>
    </pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Show the avocado at its current x, y location.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">@avocado</span><span class="p">.</span><span class="nx">render</span> <span class="p">[</span><span class="nx">@x</span><span class="p">,</span> <span class="nx">@y</span><span class="p">],</span> <span class="nx">buffer</span>
    </pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Called when another state is loaded. This gives you a chance to clean
up resources and event handlers.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">leave: </span><span class="nf">(nextStateName) -&gt;</span>
    </pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Remove our user input event handler(s).</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">avo</span><span class="p">.</span><span class="nx">Input</span><span class="p">.</span><span class="kc">off</span> <span class="s1">&#39;.InitialState&#39;</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Thu Oct 04 2012 01:34:49 GMT-0500 (CDT)  </div><div id="projectname"><a href="../../../index.html">Avocado</a></div></div></body></html>